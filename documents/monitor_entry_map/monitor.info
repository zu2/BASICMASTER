#
include workarea.info
#
label f000 jmp_mon_start
label f003 ADDIXB
comment f009 block transfer from (003b,003c)-(003d,003e) to (003f,0040)
label f009 MOVBLK
label f00c jmp_sound
comment f00d fetch keyboard. when key pressed, return CARRY=1
label f00f KBIN
label f012 CHRGET
comment f015 display 1 char. 01-0f are control code. when char is control code, return CARRY=1
label f015 CHROUT
label f018 mLOAD
label f01b mSAVE
comment f023 monitor jump table, char and address
label f023 mon_command_table
data f023-f04a
word f024
word f027
word f02a
word f02d
word f030
word f033
word f036
word f039
word f03c
word f03f
word f042
word f045
word f048
word f04b
#
comment f04d timer count from IRQ
#
lcomment f050 is 1/60s timer interrupt?
comment f059 incremnt 1/60s timer
dec f05d
#
lcomment f07a inhibit NMI
label f096 mon_Step
comment f0d0 from_break_vec
comment f0e4 recover break point SWI to original instruction
label f0e4 recover_break_point
lcomment f0e8 no break point
lcomment f0ff inhibit NMI
comment f14d zero page jump table setup
lcomment f15f inhibit NMI
comment f17f find the amount of RAM installed, every 256bytes.
comment f199 IX=IX+AccB
label f199 mon_ADDIXB
comment f1af escape command (go to basic)
label f1af mon_Escape
comment f1c9 monitor main routine (start with initialize)
label f1c9 mon_Start
comment f1da Waiting for monitor input
label f1da mon_wait_for_input
comment f1fd invalid monitor command
label f201 mon_KBIN_prompt_echo
label f203 jASCOUT_1
comment f206 get a char with asterisk cursor *
label f206 KBIN_with_asterisk
comment f20e message output from IX, 04 terminate.
label f20e mon_MESOUT
label f215 HEX4OUT_from_IX_with_space
label f217 HEX2OUT_from_IX_with_space
comment f21d hex output byte data from IX
label f21d HEX2OUT_from_IX
label f226 HEXOUT_top_A
label f22a HEXOUT_bottom_A
label f236 CHROUT_CR
lcomment f238 jump to ASCOUT
label f238 jASCOUT_2
comment f23a hex out IX reg.
label f23a HEX4OUT_IX
comment f244 output question mark and bell.
label f244 out_question_mark
label f248 bell
label f255 INHEX4
label f256 INHEX2
char  f2ab
lcomment f2ae ascii 0-9 ?
dec   f2af
lcomment f2b2 <A ?
lcomment f2b6 >Z ?
lcomment f2ba convert from A-F to 10-15
comment f2ef AccA = ((IX)<<4)+(IX+1), IX+=2
label f2ff mon_Break
lcomment f354 end of break point?
label f366 jMESOUT_1
label f369 jCHROUT_CR_1
label f36c mon_J_start_tape
comment f372 display cr and space hypthen space
label f372 CR_SP_hyphen_SP
comment f374 display space hypthen space
label f374 SP_hyphen_SP
comment f374 display space colon space
label f37e SP_colon_SP
label f388 mon_Display
label f3ac HEX4IN_ADRTOP
comment f3ac HEX4IN to (IX)
label f3af HEX4IN_FROM
label f3c1 HEX4IN_ADREND
label f3cb mon_Memory
label f3f2 mon_Register
label f40f jHEX4OUT_from_IX_with_space
label f412 jHEX2OUT_from_IX_with_space
label f45e load_breakpoint
comment f45e IX=top address of breakpoint,AccB=number of breakpoint
lcomment f461 load number of breakpoint
comment f464 IX=IX+7, AccB--
label f464 INCX7_DECB1
comment f465 IX=IX+6, AccB--
label f465 INCX6_DECB1
comment f468 IX=IX+3, AccB--
label f468 INCX3_DECB1
comment f46d IX=IX-7, AccB--
label f46d DECX7_DECB1
label f4b0 mon_Transfer
label f476 mon_Go
label f4ad jmon_MESOUT
comment f08c set break point SWI
label f08c set_break_point
comment f497 set SWI to each break point
comment f49e save original instruction
label f4ee mon_Fill
comment f51d Bell sound: ON:253cyc,OFF:262cyc,
comment f51d 1.325x(253+262)=682us=1.465KHz, 256times(0.175sec)
label f51d sound_Bell
label f531 sound_2400Hz
label f545 sound_1200Hz
comment f556 Delay routines DLYnnnn: delay nnnn cyc (1cyc:1.325μs）
label f556 DLY281
label f558 DLY238
label f55A DLY125
label f55C DLY96
label f560 DLY162
label f562 DLY105
label f563 DLY103
comment f565 sound_delay3
label f565 DLY88
label f56A DLY51
label f56B
comment f56C sound_delay4
label f56C DLY47
label f572 DLY35
comment f575 sound_delay5
label f575 DLY25
label f576 DLY23
label f577 DLY21
label f57c DLY7
comment f57e delay 10ms for remove chattering
comment f57e 7575cyc x 1.325us = 10.036875ms
lcomment f57e DLY7575
label f57e delay_10ms
comment f586 delay 1s for wait tape gap
label f586 delay_1s
label f588 sleep_by_AccA
label f593 tape_1byte_out_from_IX
label f595 tape_1byte_out_A
label f5c4 tape_block_out_from_IX
comment f60e tape save command (Punch)
label f60e mon_Punch
comment f619 mon_BYTOUT from BYTOUT
label f619 mon_BYTOUT
comment f62b copy filename from FNAME to FNAME2
comment f677 allow NMI
label f677 mom_NMICLR
comment f684 inhibit NMI
label f684 mom_NMISET
label f687 get_FNAME
label f6b5 CHROUT_CR_2
label f6b8 print_FNAME2
comment f6cc tape Load command
label f6cc mon_Load
comment f6cf tape Verify command
label f6cf mon_Verify
lcomment f6f5 last block ? (filetype:00)
lcomment f6f7 it's the last block, so stop the tape and finish.
comment f71f mon_BYTIN from BYTIN
label f71f mon_BYTIN
lcomment f725 out CR
lcomment f72B skip preamble
lcomment f738 start mark $01
lcomment f73c get filetype 〜 load address
lcomment f741 00:get from tape, other:compare with tape
label f74c ERROR_MESOUT
comment f754 read from tape AccB bytes into IX
label f754 tape_Bbyte_in
label f762 tape_1byte_in
label f794 tape_1bit_in
comment f798 $EE80:b7 Tape input
comment f7ab output 1byte to screen
label f7ab mon_CHROUT
comment CHR00
label f7da mon_CHROUT_NOP
comment f7db execute control code.
label f7db mon_CHROUT_control_code
lcomment f7e7 fetch char to put from stack
lcomment f7e9 DEL?
lcomment f7ed if DEL then lookup CHR10 adrs
word f7fa-f81b
comment f7fa control code jump table
lcomment f7fa CHR00
lcomment f7fc CHR01
lcomment f7fe CHR02
lcomment f800 CHR03
lcomment f802 CHR04
lcomment f804 CHR05
lcomment f806 CHR06
lcomment f808 CHR07
lcomment f80a CHR08
lcomment f80c CHR09
lcomment f80e CHR0A
lcomment f810 CHR0B
lcomment f812 CHR0C
lcomment f814 CHR0D
lcomment f816 CHR0E
lcomment f818 CHR0F
lcomment f81a CHR7F
comment f81c Sets a flag to display graphic characters (00-0f) instead of executing control code.
label f81c set_graphics_char_mode
comment f820 blink cursor
label f820 blink_cursor
comment f824 erase cursor
label f824 erase_cursor
label f872 scroll_up
label f8b4 scroll_down
comment f829 clear cursor position (X,Y)=(0,0)
label f829 clear_cursor_position
label f830 move_cursor_left_and_del
label f83a move_cursor_left
label f848 move_cursor_right
label f854 move_cursor_up
dec f85a
comment f860 move cursor down, if scroll needed set Z=1
label f860 move_cursor_down
label f86b CR_carriage_return
dec f865
comment f891 clear bottom row
lcomment f891 set CURSOR=(0,23)
const f892-f893
label f899 mon_clear_a_line
dec   f89a
label f8a4 mon_CLRTV
label f8d3 normal_display
label f8d7 reverse_display
label f8dd mon_MOVBLK
comment f8ea copy start from top address or end address
#
label f90a MOVBLK1
label f913 DOWNCP
label f930 RETSEQ
label f933 UPCP
comment f952 store or compare A with (IX)
label f952 STCMP
comment f95c monitor message string, which string is 04 terminate.
char f95c-fa53
label f95c mSTEP
data  f95e-f966
label f968 mBREAK
data  f969-f96f
label f971 mSWI
data  f972-f976
label f978 mMONITOR_start
data  f979-f98e
label f990 mINPUT_COMMAND
data  f992-f9a3
label f9a5 mBREAK_POINT
data f9a7-f9b3
label f9b5 mHyphen
data  f9b5-f9b7
label f9b9 mDISPLAY
data  f9bb-f9c9
label f9c5 mFROM
data  f9c5-f9c9
label f9cb mCRx3_INPUT_ADDR_AND_DATA
label f9cd mINPUT_ADDR_AND_DATA
data  f9ce-f9de
label f9db mDATA
label f9e0 mColon
data  f9e0-f9e2
label f9e4 mregister
data  f9e5-f9fd
label f9ff mSPx3
label fa03 mSTART_ADDR
data  fa04-fa11
label fa13 mTO
data  fa14-fa19
label fa1a mMASTER_BLOACK_ADDR
data  fa1b-fa2b
label fa22 mBLOCK_ADDR
label fa2e mTRANSFER
data  fa2f-fa36
label fa39 mASTERISK_ERROR
label fa3a mERROR
data  fa3a-fa40
label fa43 mPROGRAM_NAME
data  fa43-fa53
comment fa55 get a char from keyboard. display AccA as cursor
comment fa55 work M0069 char on cursor pos. 0:cursor, 1:original char.
comment fa55 (see. micom magagine 1981.3 p.150)
label fa55 mon_CHRGET
lcomment fa55 CGETKB (micom magazine)
comment faa3 calculate cursor address from CURX,CURY
comment faa3 addr = $100 + (CURY<<5) + CURX
comment faa3 addr high = $1 + (CURY>>3)
comment faa3 addr low  = (CURY<<5) + CURX
label faa3 mon_CURPOS
lcomment fab1 CLICK sound
comment fabc +$0100 for VRAM start address
comment fac6 get a char from keyboard.
label fac6 mon_KBIN
comment face kana key pressed?
comment fad8 alpha key pressed?
comment faf9 set NMI status from $0013
comment fb00 keyboard scan
comment fb00 (see. micom magagine 1981.4 p.216)
comment fb12 main keyboard size is 4x13
dec fb13
comment fb22 main keyboard size is 4x13
dec fb23
comment fb2e shift key pressed?
comment fb51 shift key pressed
comment fb51 alpha symbol shift?
comment fb90 keyboard map (KANA)
comment fb90 $70 is unassigned key
label fb90 keymap_kana
data  fb90-fbc3
label fbc4 keymap_alnum
comment fbc4 keyboard map (JIS alpha numeric)
data  fbc4-fbf7
comment fbf8 shift keymap table. keycode,ASCII
label fbf8 keymap_shift_alnum
word  fbf8-fc25
comment fc26 KANA shift keymap table
label fc26 keymap_shift_kana
word  fc26-fc49
lcomment fc6b set music on (00:rest)
label   fc78 M_next
comment fc87 M:transposition
comment fc8f sharp
comment fc96 B:flat
comment fc9d U:raise one octave
comment fcab D:lower one octave
comment fcb9 check DEFGABC
comment fce5 R:rest
comment fcf0 P:length of sound 0-9
comment fcfe Q:tone 0-4
comment fd0c AccA=(IX++)-$30, if AccA<0 return to higher level caller
label fd0c M_get_num
comment fd15 V:volume 1-5
comment fd25 T:tempo 1-7
#
label fc4a sound
#
word fea3-ffe2
#
commend ffe3 INPUT FROM-TO ADRS (HEX4)
label ffe3 HEXIN4_TOPEND
comment ffe6 inhibit NMI
label ffe6 NMISET
comment ffe9 allow NMI
label ffe9 NMICLR
comment ffec display IX in hex
label ffec OUTIX
comment ffef clear TV, cursor set 0,0
label ffef CLRTV
comment FFF2 display message from (IX), terminate with 04
label fff2 MESOUT
comment fff5 get current cursor address into IX
label fff5 CURPOS
