//
//		Character convert table
//			from UNICODE to BASICMASTER
//
#include	"common.h"

typedef	struct	{
		char	*from;
		char	*to;
		} pair_t;
pair_t table[] = {
			{"ã€€",		"$20" },		// å…¨è§’ã‚¹ãƒšãƒ¼ã‚¹
			{"Î±",		"$10" },
			{"Î²",		"$11" },
			{"Î³",		"$12" },
			{"Î·",		"$13" },
			{"Î¸",		"$14" },
			{"Î»",		"$15" },
			{"Î¼",		"$16" },
			{"Ï€",		"$17" },
			{"Ï„",		"$18" },
			{"Ï†",		"$19" },
			{"Î¦",		"$19" },
			{"Ïˆ",		"$1a" },
			{"Î¨",		"$1a" },
			{"Ï‰",		"$1b" },
			{"Î£",		"$1c" },
			{"Î©",		"$1d" },
			{"Ï‡",		"$1e" },
			{"Ã·",		"$1f" },
			{"âž—",		"$1f" },
			{"ï¿¥",		"$5c" },
			{"â– ",		"$60" },
			{"â†",		"$7b" },
			{"â†’",		"$7c" },
			{"â†“",		"$7d" },
			{"â†‘",		"$7e" },
			{"â”¼",		"$80" },	// ç½«ç·šç´ ç‰‡
			{"â•‹",		"$80" },
			{"â””",		"$81" },
			{"â”—",		"$81" },
			{"â”˜",		"$82" },
			{"â”›",		"$82" },
			{"â”",		"$83" },
			{"â”“",		"$83" },
			{"â”Œ",		"$84" },
			{"â”",		"$84" },
			{"â”€",		"$85" },
			{"â”",		"$85" },
			{"â”‚",		"$86" },
			{"â”ƒ",		"$86" },
			{"âœ›",		"$87" },	// U+271B
//			{"+ï½¥",		"$87" },	// 2B U+FF65
			{"â”¤",		"$88" },
			{"â”«",		"$88" },
			{"â”¬",		"$89" },
			{"â”³",		"$89" },
			{"â”œ",		"$8a" },
			{"â”£",		"$8a" },
			{"â”´",		"$8b" },
			{"â”»",		"$8b" },
			{"â•°",		"$8c" },
			{"â•¯",		"$8d" },
			{"â•®",		"$8e" },
			{"â•­",		"$8f" },
			{"âŒ©",		"$90" },	// U+2329
			{"âŒ„",		"$91" },	// U+2304
			{"âŒª",		"$92" },	// U+232A
			{"âŒƒ",		"$93" },	// U+2303
			{"â—¦",		"$94" },	// U+25E6
			{"â—‹",		"$94" },	// U+25CB
			{"â—",		"$95" },	// U+25CF
			{"â™£",		"$96" },	// U+2663
			{"â™§",		"$96" },	// U+2667
			{"â™¢",		"$97" },	// U+2662
			{"â™¦",		"$97" },	// U+2662
			{"â™¡",		"$98" },	// U+2661
			{"â™¥",		"$98" },	// U+2665
			{"â™ ",		"$99" },	// U+2660
			{"â™¤",		"$99" },	// U+2660
			{"å‡º",		"$9a" },	// æ¼¢å­—ã®ã€Œå‡ºã€
			{"â™ª",		"$9b" },	// U+266A
			{"ðŸƒ",		"$9c" },	// U+1F403
			{"ðŸ‚",		"$9c" },	// U+1F402
			{"ðŸ„",		"$9c" },	// U+1F404
			{"ç‰›",		"$9c" },
			{"â™ž",		"$9c" },	// U+265E	// j68
			{"â–’",		"$9d" },	// U+2592
			{"â–‘",		"$9d" },	// U+2591
			{"â–“",		"$9d" },	// U+2593
			{"å®¶",		"$9e" },
			{"â™Ÿ",		"$9e" },	// U+265F	// j68
			{"â–²",		"$9e" },	// U+25B2
			{"\\",		"$9f" },
			{"ï¹¨",		"$9f" },	// U+FE68
			{"ã€‚",		"$a1" },
			{"ã€Œ",		"$a2" },
			{"ã€",		"$a3" },
			{"ã€",		"$a4" },
			{"ãƒ»",		"$a5" },
			{"ãƒ²",		"$a6" },
			{"ã‚¡",		"$a7" },
			{"ã‚£",		"$a8" },
			{"ã‚¥",		"$a9" },
			{"ã‚§",		"$aa" },
			{"ã‚©",		"$ab" },
			{"ãƒ£",		"$ac" },
			{"ãƒ¥",		"$ad" },
			{"ãƒ§",		"$ae" },
			{"ãƒƒ",		"$af" },
			{"ãƒ¼",		"$b0" },
			{"ã‚¢",		"$b1" },
			{"ã‚¤",		"$b2" },
			{"ã‚¦",		"$b3" },
			{"ã‚¨",		"$b4" },
			{"ã‚ª",		"$b5" },
			{"ã‚«",		"$b6" },
			{"ã‚¬",		"$b6,$de" },
			{"ã‚­",		"$b7" },
			{"ã‚®",		"$b7,$de" },
			{"ã‚¯",		"$b8" },
			{"ã‚°",		"$b8,$de" },
			{"ã‚±",		"$b9" },
			{"ã‚²",		"$b9,$de" },
			{"ã‚³",		"$ba" },
			{"ã‚´",		"$ba,$de" },
			{"ã‚µ",		"$bb" },
			{"ã‚¶",		"$bb,$de" },
			{"ã‚·",		"$bc" },
			{"ã‚¸",		"$bc,$de" },
			{"ã‚¹",		"$bd" },
			{"ã‚º",		"$bd,$de" },
			{"ã‚»",		"$be" },
			{"ã‚¼",		"$be,$de" },
			{"ã‚½",		"$bf" },
			{"ã‚¾",		"$bf,$de" },
			{"ã‚¿",		"$c0" },
			{"ãƒ€",		"$c0,$de" },
			{"ãƒ",		"$c1" },
			{"ãƒ‚",		"$c1,$de" },
			{"ãƒ„",		"$c2" },
			{"ãƒ…",		"$c2,$de" },
			{"ãƒ†",		"$c3" },
			{"ãƒ‡",		"$c3,$de" },
			{"ãƒˆ",		"$c4" },
			{"ãƒ‰",		"$c4,$de" },
			{"ãƒŠ",		"$c5" },
			{"ãƒ‹",		"$c6" },
			{"ãƒŒ",		"$c7" },
			{"ãƒ",		"$c8" },
			{"ãƒŽ",		"$c9" },
			{"ãƒ",		"$ca" },
			{"ãƒ",		"$ca,$de" },
			{"ãƒ‘",		"$ca,$df" },
			{"ãƒ’",		"$cb" },
			{"ãƒ“",		"$cb,$de" },
			{"ãƒ”",		"$cb,$df" },
			{"ãƒ•",		"$cc" },
			{"ãƒ–",		"$cc,$de" },
			{"ãƒ—",		"$cc,$df" },
			{"ãƒ˜",		"$cd" },
			{"ãƒ™",		"$cd,$de" },
			{"ãƒš",		"$cd,$df" },
			{"ãƒ›",		"$ce" },
			{"ãƒœ",		"$ce,$de" },
			{"ãƒ",		"$ce,$df" },
			{"ãƒž",		"$cf" },
			{"ãƒŸ",		"$d0" },
			{"ãƒ ",		"$d1" },
			{"ãƒ¡",		"$d2" },
			{"ãƒ¢",		"$d3" },
			{"ãƒ¤",		"$d4" },
			{"ãƒ¦",		"$d5" },
			{"ãƒ¨",		"$d6" },
			{"ãƒ©",		"$d7" },
			{"ãƒª",		"$d8" },
			{"ãƒ«",		"$d9" },
			{"ãƒ¬",		"$da" },
			{"ãƒ­",		"$db" },
			{"ãƒ¯",		"$dc" },
			{"ãƒ³",		"$dd" },
			{"ã‚›",		"$de" },
			{"ã‚œ",		"$df" },
			{"æ™‚",		"$e0" },
			{"åˆ†",		"$e1" },
			{"ç§’",		"$e2" },
			{"å¹´",		"$e3" },
			{"æœˆ",		"$e4" },
			{"æ—¥",		"$e5" },
			{"ç«",		"$e6" },
			{"æ°´",		"$e7" },
			{"æœ¨",		"$e8" },
			{"é‡‘",		"$e9" },
			{"åœŸ",		"$ea" },
			{"äºº",		"$eb" },
			{"ç‚¹",		"$ec" },
			{"å›ž",		"$ed" },
			{"æ–‡",		"$ee" },
			{"å",		"$ef" },
			{"â–",		"$f0" },	// U+258F
			{"â–Ž",		"$f1" },	// U+258E
			{"â–",		"$f2" },	// U+258D
//			{"??",		"$f3" },
//			{"??",		"$f4" },
//			{"??",		"$f5" },
//			{"??",		"$f6" },
//			{"??",		"$f7" },
//			{"??",		"$f8" },
			{"â–",		"$f9" },	// U+2581
			{"â–‚",		"$fa" },	// U+2582
			{"â–ƒ",		"$fb" },	// U+2583
			{"ï¼",		"$fb" },	// U+FF0F	// j68
			{"â•±",		"$fc" },	// U+2571
			{"ï¼¼",		"$fd" },	// U+FF3C	// j68
			{"â•²",		"$fd" },	// U+2572
			{"â—†",		"$fe" },	// U+25c6	// j68
			{"â§“",		"$fe" },	// U+29D3
			{"â—‡",		"$ff" },	// U+25c7	// j68
			{"â§—",		"$ff" },	// U+29D7
			{NULL,		NULL },
		};

char	*
escape_bmchar(char *str)
{
	char	*buf = calloc(1,1000);
	char	*bp = buf;
	char	*p = str;
	int		in = -1;			// escape mode?
	char	*FCB="\tFCB\t";
	char	*FCC="\tFCC\t'";

	while(*p){
		if(*p=='\'' || *p=='\\' || *p==0x7F){
			if(in==-1) {
				in = 1;
				memcpy(bp,FCB,strlen(FCB));
				bp+=strlen(FCB);
			}else if(in==0){
				*bp++ = '\n';
				memcpy(bp,FCB,strlen(FCB));
				bp+=strlen(FCB);
				in = 1;
			}else if(in==1){
				*bp++ = ',';
			}
			char s[10];
			sprintf(s,"$%02x",*p);
			memcpy(bp,s,strlen(s));
			bp+=strlen(s);
		}else if(*p>=0x20 && *p<=0x7E){				// ASCII
			if(in==-1) {
				memcpy(bp,FCC,strlen(FCC));
				bp+=strlen(FCC);
				in = 0;
			}else if(in==1){
				*bp++='\n';
				memcpy(bp,FCC,strlen(FCC));
				bp+=strlen(FCC);
				in = 0;
			}
			*bp++ = *p++;
			continue;
		}else{									// not ASCII, escape it!
			if(in==-1) {
				memcpy(bp,FCB,strlen(FCB));
				bp+=strlen(FCB);
				in = 1;
			}else if(in==0){
				*bp++ = '\'';
				*bp++ = '\n';
				memcpy(bp,FCB,strlen(FCB));
				bp+=strlen(FCB);
				in = 1;
			}else if(in==1){
				*bp++ = ',';
			}
			int i=0;
			for(i=0; table[i].from!=NULL; i++) {
				if(memcmp(p,table[i].from,strlen(table[i].from))==0) {	// å¤‰æ›ã™ã‚‹
					memcpy(bp,table[i].to,strlen(table[i].to));
					p+=strlen(table[i].from);
					bp+=strlen(table[i].to);
					break;
				}
			}
			if(table[i].from==NULL){
				error("; convert error");
			}
		}
	}
	if(in==0){
		*bp++ = '\'';
		*bp++ = '\n';
	}else if(in==1){
		*bp++ = '\n';
	}
	return buf;
}
